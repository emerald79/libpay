#include <stdint.h>
#include <stdio.h>
#include <tlv.h>

int main(void)
{
	struct tlv *tlv;
	uint8_t int_auth_rsp[] = {
		0x77, 0x63, 0x9F, 0x4B, 0x60, 0x2C, 0x47, 0x9B, 0x2F, 0xCC,
		0xFE, 0x5A, 0xAB, 0x76, 0x34, 0x32, 0xFC, 0x86, 0xD9, 0x03,
		0x4F, 0x01, 0x3F, 0x5B, 0x72, 0x65, 0x65, 0x08, 0x08, 0x69,
		0xBF, 0x97, 0x9F, 0x68, 0x22, 0x15, 0x3B, 0x22, 0x72, 0x24,
		0x71, 0x82, 0x01, 0xF9, 0x92, 0x15, 0x1D, 0x58, 0x71, 0x8E,
		0x11, 0x94, 0x37, 0xF3, 0x2E, 0x68, 0x86, 0x04, 0x84, 0x04,
		0x10, 0xCB, 0x86, 0xC8, 0x45, 0x5E, 0x16, 0x91, 0xF5, 0x37,
		0xE1, 0x26, 0x02, 0xAE, 0x1D, 0x97, 0xCC, 0x37, 0x3B, 0x72,
		0x5D, 0x52, 0xB8, 0xF8, 0x74, 0xB8, 0xE0, 0x06, 0x8D, 0x18,
		0x02, 0x0F, 0x8B, 0xD4, 0xA5, 0x6A, 0x00, 0x5A, 0x71, 0x22,
		0xA2
	};
	uint8_t read_record_rsp[] = {
		0x70, 0x39, 0x5A, 0x0A, 0x67, 0x99, 0x99, 0x89, 0x00, 0x00,
		0x02, 0x00, 0x06, 0x9F, 0x5F, 0x24, 0x03, 0x25, 0x12, 0x31,
		0x5F, 0x25, 0x03, 0x04, 0x01, 0x01, 0x5F, 0x34, 0x01, 0x25,
		0x9F, 0x07, 0x02, 0xFF, 0x00, 0x9F, 0x0D, 0x05, 0xFC, 0x50,
		0xA0, 0x00, 0x00, 0x9F, 0x0E, 0x05, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x9F, 0x0F, 0x05, 0xF8, 0x70, 0xA4, 0x98, 0x00
	};
	int rc;

	rc = tlv_parse(read_record_rsp, sizeof(read_record_rsp), &tlv);
	if (rc != TLV_RC_OK)
		return EXIT_FAILURE;

	for (; tlv; tlv = tlv_get_next(tlv)) {
		uint8_t buffer[256];
		size_t size;
		int i;
		size = sizeof(buffer);
		tlv_encode_identifier(tlv, buffer, &size);
		for (i = 0; i < (int)size; i++)
			printf("%02X", buffer[i]);
		printf(" ");
		size = sizeof(buffer);
		tlv_encode_length(tlv, buffer, &size);
		for (i = 0; i < (int)size; i++)
			printf("%02X", buffer[i]);
		printf(" ");
		size = sizeof(buffer);
		tlv_encode_value(tlv, buffer, &size);
		for (i = 0; i < (int)size; i++)
			printf("%02X", buffer[i]);
		printf("\n");
	}

	tlv_free(tlv);

	return EXIT_SUCCESS;
}
